@font-face {
  font-family: "Google Sans";
  src: url("../fonts/GoogleSans/GoogleSans-Regular.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Google Sans";
  src: url("../fonts/GoogleSans/GoogleSans-Medium.ttf") format("truetype");
  font-weight: 500;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Google Sans";
  src: url("../fonts/GoogleSans/GoogleSans-SemiBold.ttf") format("truetype");
  font-weight: 600;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Roboto Mono";
  src: url("../fonts/RobotoMono/RobotoMono-Regular.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Roboto Mono";
  src: url("../fonts/RobotoMono/RobotoMono-Medium.ttf") format("truetype");
  font-weight: 500;
  font-style: normal;
  font-display: swap;
}

body {
  background: var(--bg-primary);
  color: var(--text-primary);
  font-family: "Google Sans", system-ui, -apple-system, sans-serif;
  -webkit-font-smoothing: antialiased;
  line-height: 1.5;
}

mark {
  background: var(--accent-glow);
  color: inherit;
  padding: 0 2px;
  border-radius: 3px;
}

[data-theme="light"] mark {
  background: var(--accent-soft);
}

.app-shell {
  min-height: 100vh;
  width: 100%;
  background: var(--bg-primary);
  color: var(--text-primary);
  display: flex;
  flex-direction: column;
}

.toolbar {
  position: relative;
  height: 64px;
  padding: 0 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--rule-color);
  z-index: 10;
  flex-wrap: wrap;
}

.toolbar-left {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.toolbar-resume {
  padding: 4px 10px;
  font-size: 11px;
}

.brand {
  font-size: 15px;
  font-weight: 600;
  letter-spacing: 0.02em;
  display: flex;
  align-items: center;
  gap: 8px;
}

.brand-button {
  background: transparent;
  border: none;
  color: inherit;
  cursor: pointer;
  padding: 0;
}

.brand-button:hover {
  opacity: 0.8;
}

.toolbar-home {
  padding: 6px 10px !important;
  font-size: 16px !important;
  border: none !important;
  background: transparent !important;
  opacity: 0.7;
  transition: opacity 0.2s;
}

.toolbar-home:hover {
  opacity: 1 !important;
  border: none !important;
}

.toolbar-actions {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

.toolbar-menu {
  position: relative;
}

.toolbar-menu-panel {
  position: absolute;
  right: 0;
  top: calc(100% + 8px);
  min-width: 200px;
  background: var(--bg-secondary);
  border: 1px solid var(--rule-color);
  border-radius: 12px;
  padding: 8px;
  box-shadow: 0 16px 40px rgba(15, 23, 42, 0.35);
  z-index: 12;
  display: grid;
  gap: 4px;
}

.toolbar-menu-item {
  border: none;
  background: transparent;
  color: var(--text-primary);
  text-align: left;
  padding: 8px 10px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
}

.toolbar-menu-item:hover {
  background: var(--accent-faint);
}

.toolbar-menu-item:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.toolbar-menu-divider {
  height: 1px;
  background: var(--rule-color);
  margin: 4px 0;
}

.toolbar-search {
  position: relative;
  display: flex;
  align-items: center;
  gap: 6px;
  border: 1px solid var(--rule-color);
  background: var(--bg-primary);
  padding: 4px 10px;
  border-radius: 999px;
}

.toolbar-search-input {
  border: none;
  background: transparent;
  color: var(--text-primary);
  font-size: 12px;
  font-family: "Google Sans", system-ui, -apple-system, sans-serif;
  width: 180px;
}

.toolbar-search-input:focus {
  outline: none;
}

.toolbar-search-clear,
.toolbar-search-submit {
  border: none;
  background: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 12px;
  padding: 2px 4px;
}

.toolbar-search-submit:hover,
.toolbar-search-clear:hover {
  color: var(--accent);
}

.toolbar-search-panel {
  position: absolute;
  top: 44px;
  left: 0;
  min-width: 280px;
  max-width: 360px;
  background: var(--bg-secondary);
  border: 1px solid var(--rule-color);
  border-radius: 12px;
  padding: 8px;
  box-shadow: 0 16px 32px rgba(0, 0, 0, 0.2);
  z-index: 30;
}

.toolbar-search-result {
  width: 100%;
  text-align: left;
  border: none;
  background: transparent;
  color: var(--text-primary);
  padding: 8px 10px;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  cursor: pointer;
}

.toolbar-search-result:hover {
  background: var(--accent-faint);
}

.search-result-title {
  font-size: 12px;
  font-weight: 600;
}

.search-result-snippet {
  font-size: 11px;
  color: var(--text-secondary);
}

.toolbar-search-empty {
  padding: 10px 12px;
  font-size: 12px;
  color: var(--text-muted);
}

.toolbar-search-scholar .toolbar-search-input {
  width: 160px;
}

.toolbar-button,
.file-upload {
  border: 1px solid var(--rule-color);
  background: transparent;
  color: var(--text-primary);
  padding: 8px 14px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  min-height: 44px;
}

.toolbar-button.toolbar-nav {
  padding: 6px 12px;
  font-size: 12px;
}

.toolbar-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.toolbar-button:hover,
.file-upload:hover {
  border-color: var(--text-secondary);
}

.toolbar-button.active {
  border-color: var(--accent);
  color: var(--accent);
}

.file-upload {
  position: relative;
  overflow: hidden;
}

.file-upload input {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

.status {
  margin: 24px auto 0;
  max-width: 900px;
  padding: 10px 16px;
  border-radius: 8px;
  background: var(--bg-secondary);
  border: 1px solid var(--rule-color);
  color: var(--text-secondary);
  font-size: 13px;
}

.document-stats {
  margin: 12px auto 0;
  max-width: 1300px;
  padding: 10px 16px;
  border-radius: 10px;
  background: var(--bg-secondary);
  border: 1px solid var(--rule-color);
  color: var(--text-secondary);
  font-size: 13px;
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: center;
}

.paper-canvas {
  background: var(--bg-primary);
  color: var(--text-primary);
  max-width: 900px;
  padding: var(--paper-margin, 24mm);
  padding-top: calc(var(--paper-margin, 24mm) + var(--paper-header-height, 0px));
  padding-bottom: calc(var(--paper-margin, 24mm) + var(--paper-footer-height, 0px));
  font-family: var(--paper-font-family, "Google Sans", system-ui, -apple-system, sans-serif);
  font-size: var(--paper-font-size, 14.5px);
  font-weight: var(--paper-font-weight, 400);
  line-height: var(--paper-line-height, 1.65);
}

[data-exporting="pdf"] .document-container {
  margin: 0;
  padding: 0;
  max-width: none;
}

[data-exporting="pdf"] .paper-canvas {
  max-width: none;
  width: 100%;
  padding: var(--paper-margin, 24mm);
  padding-top: calc(var(--paper-margin, 24mm) + var(--paper-header-height, 0px));
  padding-bottom: calc(var(--paper-margin, 24mm) + var(--paper-footer-height, 0px));
}

/* Legacy fallback for DocumentEditor view */
.editor-container .paper-canvas {
  margin: 32px auto 0;
  padding: var(--paper-margin, 24mm);
}

.paper-canvas h1 {
  font-size: 1.93em;
  font-weight: 600;
  margin: 0 0 12px;
  line-height: 1.25;
  letter-spacing: -0.01em;
}

.paper-canvas h2 {
  font-size: 1.38em;
  font-weight: 500;
  color: var(--text-secondary);
  margin: 0 0 24px;
  line-height: 1.3;
}

.paper-canvas h3 {
  font-size: 1.1em;
  font-weight: 600;
  margin: 24px 0 12px;
  line-height: 1.25;
}

.paper-canvas h4 {
  font-size: 1em;
  font-weight: 600;
  margin: 20px 0 10px;
  line-height: 1.25;
  color: var(--text-secondary);
}

.format-lock {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid var(--rule-color);
  background: var(--bg-secondary);
  font-size: 12px;
  color: var(--text-secondary);
  flex-wrap: wrap;
}

.format-lock strong {
  color: var(--text-primary);
  font-weight: 600;
}

.format-lock-label {
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-size: 10px;
  color: var(--text-muted);
}

.format-lock-meta {
  color: var(--text-muted);
}

.paper-canvas p {
  font-size: 1em;
  line-height: inherit;
  margin: var(--paper-paragraph-spacing, 12px) 0;
}

.paper-canvas.plain-text p {
  white-space: pre-wrap;
}

.paper-spacer {
  height: calc(var(--paper-line-height, 1.65) * 1em);
}

.paper-header,
.paper-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 0.75em;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-muted);
}

.paper-header {
  margin-bottom: 18px;
}

.paper-footer {
  margin-top: 18px;
}

.paper-header-text {
  max-width: 60%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.page-number::after {
  content: "1";
}

.paper-canvas p code,
.paper-canvas li code {
  font-family: "Roboto Mono", monospace;
  font-size: 0.95em;
  background: var(--bg-secondary);
  border: 1px solid var(--rule-color);
  padding: 1px 6px;
  border-radius: 6px;
  color: var(--accent);
}

.paper-canvas ul,
.paper-canvas ol {
  margin: var(--paper-paragraph-spacing, 12px) 0
    calc(var(--paper-paragraph-spacing, 12px) + 4px);
  padding-left: 24px;
}

.paper-canvas li {
  font-size: 1em;
  line-height: inherit;
  margin-bottom: 8px;
}

.paper-canvas blockquote {
  margin: var(--paper-paragraph-spacing, 12px) 0;
  padding: 12px 18px;
  border-left: 3px solid var(--rule-color);
  background: var(--bg-secondary);
  color: var(--text-secondary);
  font-style: italic;
}

.reference-list {
  padding-left: 24px;
  margin-top: 12px;
}

.reference-list li {
  margin-bottom: 10px;
  padding-left: 16px;
  text-indent: -16px;
}

.divider {
  height: 1px;
  background: var(--rule-color);
  margin: 28px 0;
}

.mono {
  font-family: "Roboto Mono", monospace;
  font-size: 0.93em;
  background: var(--bg-secondary);
  padding: 10px 12px;
  border-radius: 6px;
  border: 1px solid var(--rule-color);
  color: var(--accent);
  white-space: pre-wrap;
}

.meta-block {
  margin: 24px 0 0;
  padding: 16px;
  background: var(--bg-secondary);
  border-radius: 8px;
  border: 1px solid var(--rule-color);
}

.meta-row {
  display: grid;
  grid-template-columns: minmax(140px, 200px) 1fr;
  gap: 12px;
  padding: 8px 0;
}

.meta-row + .meta-row {
  border-top: 1px solid var(--rule-color);
}

.meta-row dt {
  font-size: 0.76em;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-muted);
}

.meta-row dd {
  margin: 0;
  font-family: "Roboto Mono", monospace;
  font-size: 0.9em;
}

.paper-canvas.format-apa h1,
.paper-canvas.format-apa h2,
.paper-canvas.format-apa h3,
.paper-canvas.format-apa h4,
.paper-canvas.format-mla h1,
.paper-canvas.format-mla h2,
.paper-canvas.format-mla h3,
.paper-canvas.format-mla h4,
.paper-canvas.format-chicago h1,
.paper-canvas.format-chicago h2,
.paper-canvas.format-chicago h3,
.paper-canvas.format-chicago h4 {
  font-size: 1em;
  line-height: inherit;
  font-weight: 700;
  letter-spacing: 0;
}

.paper-section {
  margin-top: 24px;
}

.hash-footnote {
  max-width: 900px;
  margin: 32px auto 48px;
  padding: 0 48px;
  color: var(--text-muted);
  font-size: 12px;
  font-family: "Roboto Mono", monospace;
}

.print-hash {
  display: none;
  margin-top: 36px;
  padding-top: 16px;
  border-top: 1px solid var(--rule-color);
  color: var(--text-muted);
  font-size: 12px;
  font-family: "Roboto Mono", monospace;
  word-break: break-all;
}

@media (max-width: 720px) {
  .toolbar {
    flex-direction: column;
    height: auto;
    padding: 12px 16px;
    gap: 12px;
  }

  .toolbar-actions {
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
  }

  .toolbar-search {
    width: 100%;
    justify-content: space-between;
  }

  .toolbar-search-input {
    width: 100%;
  }

  .toolbar-search-panel {
    left: 0;
    right: 0;
    min-width: 0;
    max-width: none;
  }

  .toolbar-button,
  .file-upload {
    padding: 6px 12px;
    font-size: 12px;
    min-height: 44px;
  }

  .paper-canvas {
    padding: 48px 24px 80px;
  }

  .meta-row {
    grid-template-columns: 1fr;
  }
}

/* Print Layout (Table Hack for Repeating Headers/Margins) */
.print-layout {
  width: 100%;
  border-collapse: collapse;
}

.print-layout thead,
.print-layout tfoot,
.print-layout tbody,
.print-layout tr,
.print-layout td {
  border: none;
  padding: 0;
  margin: 0;
}

/* Screen Mode: Behave like blocks */
@media screen {
  .print-layout,
  .print-layout tbody,
  .print-layout tr,
  .print-layout td {
    display: block;
    width: 100%;
  }

  .print-layout thead,
  .print-layout tfoot {
    display: none; /* Hide print spacers on screen */
  }

  /* Restore screen headers/footers if needed, 
     but DocumentRenderer puts them in thead/tfoot now.
     We need to show them on screen? 
     Actually, DocumentRenderer puts headers in thead. 
     If we hide thead on screen, we lose headers on screen!
     
     Wait, the previous design had headers ABSOLUTELY positioned or FLEX for screen?
     Screen view usually doesn't show "Page 1" headers repeating.
     It shows a single continuous doc.
     So hiding thead/tfoot on screen is CORRECT for "continuous" view.
     BUT we need the Title/Meta (which is in tbody) to show.
     
     Check DocumentRenderer again:
     <header> (Title, Subtitle, Meta) is in <tbody>.
     The "Paper Header" (Page 1, Running Head) is in <thead>.
     So hiding <thead> on screen is correct!
  */
}

@media print {
  @page {
    margin: 0; /* Borderless */
  }

  * {
    animation: none !important;
    transition: none !important;
    box-shadow: none !important;
  }

  html {
    background: var(--bg-primary) !important;
  }

  body {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    background: var(--bg-primary) !important;
    counter-reset: page;
    margin: 0;
  }

  /* Hide UI */
  .toolbar,
  .status,
  .document-stats,
  .hash-footnote,
  .start-assistant,
  .assistant-toggle,
  .assistant-panel,
  .editor-toolbar,
  .editor-sidebar,
  .editor-mode-toggle,
  .save-status,
  .save-btn,
  .add-paragraph-btn,
  .add-section-btn,
  .remove-section-btn,
  .remove-paragraph-btn,
  .paragraph-actions,
  .format-toolbar,
  .format-lock-row,
  .editor-markdown-actions,
  .editor-format-panel,
  .editor-notes-panel,
  .editor-sources-panel,
  .editor-tips,
  .editor-alert {
    display: none !important;
  }

  .app-shell {
    padding-top: 0;
    min-height: 100vh;
  }

  .document-container {
    display: block;
    padding: 0;
    margin: 0;
    max-width: none;
  }

  .document-sidebar,
  .table-of-contents {
    display: none !important;
  }

  .format-lock {
    display: none !important;
  }

  /* Table Layout for Print */
  .paper-canvas {
    padding: 0 !important;
    margin: 0;
    max-width: none;
    width: 100%;
    display: block; /* Wrapper */
  }

  .print-layout {
    display: table;
    width: 100%;
  }

  .print-layout thead {
    display: table-header-group;
  }

  .print-layout tfoot {
    display: table-footer-group;
  }
  
  .print-layout tbody {
    display: table-row-group;
  }

  .print-layout tr {
    display: table-row;
  }

  .print-layout td {
    display: table-cell;
  }

  /* Spacers replace the @page margin */
  .print-header-spacer {
    height: calc(var(--paper-margin, 24mm) + var(--paper-header-height, 0px));
    position: relative;
    /* Ensure content doesn't clip if header is large */
  }

  .print-footer-spacer {
    height: calc(var(--paper-margin, 24mm) + var(--paper-footer-height, 0px));
    position: relative;
  }
  
  /* Positioning headers inside the spacer */
  .paper-header {
    position: absolute;
    bottom: 12px; /* Slight offset from content */
    left: var(--paper-margin, 24mm);
    right: var(--paper-margin, 24mm);
    margin: 0;
  }

  .paper-footer {
    position: absolute;
    top: 12px; /* Slight offset from content */
    left: var(--paper-margin, 24mm);
    right: var(--paper-margin, 24mm);
    margin: 0;
  }

  /* Horizontal Margins via Padding on Content Cell */
  .print-layout tbody td {
    padding-left: var(--paper-margin, 24mm);
    padding-right: var(--paper-margin, 24mm);
  }
  
  /* Also align headers/footers spacers to margin? 
     No, the spacer div is full width, we positioned the text inside.
  */

  .paper-section,
  .meta-block,
  .mono,
  .divider,
  pre,
  blockquote,
  table,
  ul,
  ol,
  li,
  img {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  .paper-section.level-1 {
    break-before: page;
    page-break-before: always;
  }

  .paper-section.level-1:first-of-type {
    break-before: auto;
    page-break-before: auto;
  }

  .paper-canvas h2,
  .paper-canvas h3,
  .paper-canvas h4 {
    break-after: avoid;
    page-break-after: avoid;
  }

  .paper-canvas p,
  .paper-canvas li {
    orphans: 3;
    widows: 3;
  }

  .print-hash {
    display: block;
    margin-top: 24px;
    padding-top: 12px;
    border-top: 1px solid var(--rule-color);
  }
}
